@model Amritnagar.Models.ViewModel.VoucherEntryViewModel

@{
    ViewBag.Title = "VoucherEntry";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .size {
        width: 150px;
        height: 25px;
    }

    .sizeM {
        width: 120px;
        height: 25px;
    }

    .sizeM_whitebg {
        width: 140px;
        height: 25px;
        background-color: white
    }

    .sizeS {
        width: 50px;
        height: 25px;
    }

    .sizeM1 {
        width: 100px;
        height: 25px;
    }

    .sizeM_smry {
        width: 100px;
        height: 25px;
        background-color: white
    }

    .sizeS_smry {
        width: 65px;
        height: 25px;
        background-color: white
    }

    .sizeL {
        width: 250px;
        height: 25px;
    }

    .sizeXL {
        width: 300px;
        height: 25px;
    }

    .sizebig {
        width: 220px;
        height: 25px;
    }

    .heading {
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        color: saddlebrown;
        font-size: 30px;
        text-align: center;
    }

    .tab {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 12px;
        border-collapse: collapse;
        width: 1000px;
        margin-left: auto;
        margin-right: auto;
    }

        .tab tbody {
            display: block;
            width: 1000px;
            overflow: auto;
            height: 200px;
            text-align: center;
        }

        .tab td, .tab th {
            border: 1px solid #ddd;
            padding: 8px;
            border-collapse: collapse;
            width: 1000px;
        }

        .tab tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .tab tr:hover {
            background-color: rgba(255, 182, 193, 0.2);
        }

        .tab th {
            padding: 8px;
            text-align: center;
            /*background-color: #04AA6D;*/
            background-color: firebrick;
            font-size: 12px;
            color: white;
            position: sticky;
            top: 0;
        }

    .tab_txt {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 12px;
        border-collapse: collapse;
        width: 1020px;
        margin-left: auto;
        margin-right: auto;
    }

        .tab_txt tbody {
            display: block;
            width: 1020px;
            overflow: auto;
            height: 120px;
            text-align: center;
        }

        .tab_txt td, .tab_txt th {
            border: 1px solid #ddd;
            padding: 5px;
            border-collapse: collapse;
            width: 1020px;
        }

        .tab_txt td {
            background-color: #ece9fb
        }
        /*.tab_txt tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            .tab_txt tr:hover {
                background-color: rgba(255, 182, 193, 0.2);
            }
    */
        .tab_txt th {
            padding: 5px;
            text-align: center;
            /*background-color: #04AA6D;*/
            background-color: rgb(93, 67, 221,0.6);
            font-size: 12px;
            color: white;
            position: sticky;
            top: 0;
        }

    input {
        background-color: rgb(226,148,91,0.2)
    }

    select {
        background-color: rgb(226,148,91,0.2)
    }

    input:focus {
        background-color: rgba( 226,148,91, 0.6);
    }

    select:focus {
        background-color: rgba(226,148,91, 0.6);
    }
</style>
<form asp-controller="Account" asp-action="VoucherEntry" method="post" enctype="multipart/form-data">
    <div class="container" style="height:60px">

    </div>
    <div class="heading mt-4">
        Voucher Entry
    </div>
    <div class="container mt-3">
        <div class="row justify-content-md-center">
            <div class="col-lg-12 col-md-12 col-sm-12 col-12 border border-1 rounded border-danger" style="width:1080px">

                <div class="row mt-1">
                    <div class="col-lg-2 col-md-2 col-sm-12 col-12">
                        Branch<br />
                        @Html.DropDownListFor(p => p.branch, new SelectList(Model.BranchDesc, "Value", "Text"), "Select", new { @class = "size" })
                    </div>
                    <div class="col-lg-2 col-md-2 col-sm-12 col-12">
                        Voucher Date:<br />
                        @Html.TextBoxFor(model => model.vch_date, new { @class = "size", @type = "text", onkeypress = "javascript:return evtDate(event);" })
                    </div>
                    <div class="col-lg-2 col-md-2 col-sm-12 col-12">
                        Voucher No:<br />
                        @Html.TextBoxFor(model => model.txtvch_No, new { @class = "size", @type = "text" })
                    </div>
                    <div class="col-lg-2 col-md-2 col-sm-12 col-12">
                        <br />
                        @Html.DropDownListFor(p => p.vch_no, new SelectList(new string[] { "Select Voucher" }), new { @onchange = "GetVoucherList()", @class = "size" })
                    </div>
                    <div class="col-lg-2 col-md-2 col-sm-12 col-12">
                        Voucher Type:<br />
                        @Html.DropDownListFor(p => p.vch_type, new SelectList(new string[] { "Cash", "Transfer" }), new { @class = "size" })
                    </div>
                    <div class="col-lg-1 col-md-1 col-sm-12 col-12 mt-3">
                        <input id="ButtonSave" type="button" value="Save" name="ButtonSave" class="btn btn-primary btn-sm" />
                    </div>

                </div>
                <div class="container mt-2">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-12 text-center p-1" style="background-color: rgba(231,205,167); color: brown; font-size: 15px; font-weight: bold; text-align: center; text-transform: uppercase">
                            p a r t i c u l a r s &nbsp;&nbsp; o f  &nbsp;&nbsp;  t r a n s a c t i o n s
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-12 text-center">

                            <table class="tab_txt">

                                <tr>
                                    <th>Srl</th>
                                    <th>Dr/Cr</th>
                                    <th>Account Head</th>
                                    <th>Ac No</th>
                                    <th>Paid To/Recd.From/Perticulars</th>
                                    <th>Amount</th>
                                    <th>Ref.A/C Head</th>
                                    <th>Ref.A/C No</th>
                                    <th>Ref.A/C Particulars</th>
                                    <th>&nbsp;&nbsp;&nbsp;</th>
                                </tr>
                                <tr>
                                    <td>@Html.TextBoxFor(model => model.srl, new { @class = "sizeS", @type = "text" })</td>
                                    <td>@Html.TextBoxFor(model => model.drcr, new { @class = "sizeS", @type = "text" })</td>
                                    <td>@Html.TextBoxFor(model => model.vch_achd, new { @class = "sizeM1", @type = "text" })</td>
                                    <td>@Html.TextBoxFor(model => model.vchpacno, new { @class = "sizeM1", @type = "text" })</td>
                                    <td>@Html.TextBoxFor(model => model.particular, new { @class = "size", @type = "text" })</td>
                                    <td>@Html.TextBoxFor(model => model.amount, new { @class = "sizeM1", @type = "text" })</td>
                                    <td>@Html.TextBoxFor(model => model.ref_ac_hd, new { @class = "sizeM1", @type = "text" })</td>
                                    <td>@Html.TextBoxFor(model => model.refacno, new { @class = "sizeM1", @type = "text" })</td>
                                    <td>@Html.TextBoxFor(model => model.refParticular, new { @class = "sizeM1", @type = "text" })</td>
                                    <td><input id="ButtonAdd" type="button" value="ADD" name="ButtonAdd" class="btn btn-primary btn-sm" onclick="addvoucher()" /></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-12 text-center">
                            <div class="table-responsive mt-1">
                                <table id="TempVchData" class="tab">
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container mt-1 p-1" style="border: 1px solid; border-color: darkslateblue; background-color: rgb(216, 191, 216,0.5); color: #722F37;font-weight:bold;font-size:14px">
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-12 col-12">

                        </div>
                        <div class="col-lg-3 col-sm-12 col-12">
                            Debit Amount @Html.TextBoxFor(model => model.debt_amt, new { @class = "sizeM", @type = "text" })
                        </div>
                        <div class="col-lg-3 col-sm-12 col-12">
                            Credit Amount @Html.TextBoxFor(model => model.crdt_amt, new { @class = "sizeM", @type = "text" })
                        </div>
                        <div class="col-lg-3 col-sm-12 col-12">
                            Net Amount @Html.TextBoxFor(model => model.net_amt, new { @class = "sizeM", @type = "text" })
                        </div>
                    </div>
                </div>
                <div class="container mt-2">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-12 text-center p-1" style="background-color: rgba(231,205,167); color: brown; font-size: 15px; font-weight: bold; text-align: center; text-transform: uppercase">
                            c h e q u e &nbsp;&nbsp; p a r t i c u l a r s
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-12 text-center">
                            <div class="table-responsive mt-1">
                                <table id="" class="tab">
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container mt-1 p-2" style="background-color: #fafad2;color:saddlebrown;font-weight:bold;font-size:14px;border:1px solid; border-color:saddlebrown">
                    <div class="row">
                        <div class="col-lg-8 col-sm-12 col-12">

                        </div>
                        <div class="col-lg-4 col-sm-12 col-12">
                            Total Cheque Amount @Html.TextBoxFor(model => model.tot_chq_amt, new { @class = "sizeM_whitebg", @type = "text" })
                        </div>

                    </div>
                </div>
                <div class="container mt-1 p-2" style="color:saddlebrown;font-weight:bold;font-size:14px;border:1px solid; border-color:saddlebrown">
                    <div class="row">

                        <div class="col-lg-3 col-sm-12 col-12">
                            @Html.TextBoxFor(model => model.del_vch_no, new { @class = "sizebig", @type = "text" })
                        </div>
                        <div class="col-lg-4 col-sm-12 col-12">
                            <input id="ButtonDelVchNo" type="button" value="Delete by VCH No" name="ButtonDelVchNo" class="btn btn-primary btn-sm" />
                        </div>

                    </div>
                </div>
                <div class="container mt-2">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-12 text-center p-1" style="background-color: rgba(231,205,167); color: brown; font-size: 15px; font-weight: bold; text-align: center; text-transform: uppercase">
                            n a r r a t i o n
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</form>

@section scripts
    {
    <script type="text/javascript" src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            $("#debt_amt").val("0");
            $("#crdt_amt").val("0");
            $("#net_amt").val("0");
            $('#loading').hide();
        });

        function evtDate(evt) {

            var charCode = (evt.which) ? evt.which : event.keyCode;
            if ((charCode < 106 || charCode > 95) && (charCode < 58 || charCode > 47) && charCode != 13 && charCode == 191 && charCode == 111 && (charCode < 65 || charCode > 90))
                return false;
            else if (charCode == 13) {
                GetVoucherNo();
            }
        }

        function GetVoucherNo() {
            var branch = $('#branch').val();
            var vch_date = $('#vch_date').val();
            $.ajax({
                url: '@Url.Action("FillVoucherNo", "Account")',
            type: "GET",
            dataType: "JSON",
                data: {branch: branch, vch_date: vch_date},
                success: function (vchnos) {
                    $("#vch_no").html(""); // clear before appending new list
                    $.each(vchnos, function (i, c) {
                        $("#vch_no").append(
                    $('<option></option>').val(c.value).html(c.text));
                    });
                    $("#vch_no").focus();
                }
            });
        }

        function GetVoucherList() {
            let ModelObject = {
                vch_date: $('#vch_date').val(),
                vch_no: $('#vch_no').val(),
                branch: $('#branch').val(),
            };
              $.ajax({
                type: "POST",
                url: '@Url.Action("GetVoucherDetailsList", "Account")',
                data: ModelObject,
                dataType: "json",
                success: function (data)
                {
                    document.getElementById("TempVchData").innerHTML = data.tableElement;
                    $("#debt_amt").val(data.debt_amt);
                    $("#crdt_amt").val(data.crdt_amt);
                    $("#net_amt").val(data.net_amt);
                    /*$("#vch_DrCr").val(data.vch_DrCr);*/
                },
                error: function (err) {
                    alert(err);
                }
            });
        }

        function addvoucher() {
            //alert("OK")
            let ModelObject = {
                vch_date: $('#vch_date').val(),
                drcr: $('#drcr').val(),
                vch_achd: $('#vch_achd').val(),
                vchpacno: $('#vchpacno').val(),
                particular: $('#particular').val(),
                amount: $('#amount').val(),
                ref_ac_hd: $('#ref_ac_hd').val(),
                refacno: $('#refacno').val(),
                refParticular: $('#refParticular').val(),
                vch_no: $('#txtvch_No').val()
            };
            //alert(JSON.stringify(ModelObject));
            $.ajax({
                type: "POST",
                url: '@Url.Action("Add_Vch_In_Temp_table", "Account")',
                data: ModelObject,
                dataType: "json",
                success: function (data)
                {
                    ShowTable();
                    //if ($('#drcr').val() == "D") {
                    //    $("#debit").val(parseFloat($('#debit').val()) + parseFloat($('#amount').val()));
                    //    $("#net_amt").val(parseFloat($('#net_amt').val()) - parseFloat($('#amount').val()));
                    //}
                    //if ($('#drcr').val() == "C") {
                    //    $("#credit").val(parseFloat($('#credit').val()) + parseFloat($('#amount').val()));
                    //    $("#net_amt").val(parseFloat($('#net_amt').val()) + parseFloat($('#amount').val()));
                    //}

                    $('#vchpacno').val("");
                    $('#drcr').val("");
                    $('#particular').val("");
                    $('#amount').val("");
                    $('#refacno').val("");
                    $('#refParticular').val("");
                    $('#drcr').focus();
                },
                error: function (err) {
                    alert(err);
                }

            });



        }

        function ShowTable() {
            let ModelObject = { vch_date: $('#vch_date').val(), vch_no: $('#txtvch_No').val()};
            //alert(JSON.stringify(ModelObject));
            $.ajax({
                type: "POST",
                     url: '@Url.Action("GetTempData", "Account")',
                    data: ModelObject,
                    dataType: "json",
                success: function (data) {
                  document.getElementById("TempVchData").innerHTML = data;
                },
                error: function (err) {
                alert("Error Occured");
                }
            });
        }


    </script>
}


